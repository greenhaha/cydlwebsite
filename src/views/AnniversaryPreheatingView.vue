<template>
  <div class="preheating-page">
    <!-- ä¸“å±èƒŒæ™¯ -->
    <div class="fixed inset-0 w-full h-full">
      <div class="absolute inset-0 bg-cover bg-center bg-no-repeat"
           style="background-image: url('https://greenhaha.oss-cn-beijing.aliyuncs.com/frontend/assets/image/cs2CTVST.png')">
      </div>
      <div class="absolute inset-0 bg-gradient-to-b from-black/80 via-black/60 to-black/80"></div>
      <!-- å¢åŠ çº¹ç†é®ç½©æå‡å¯¹æ¯”åº¦ -->
      <div class="absolute inset-0 bg-black/40"></div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="preheating-content relative z-10 min-h-screen flex flex-col items-center pt-20 pb-16">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <div class="fixed top-0 left-0 right-0 z-30 bg-black/70 backdrop-blur-lg border-b border-purple-400/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div class="flex justify-center">
            <RouterLink
              to="/"
              class="inline-flex items-center px-6 py-3 text-white hover:text-purple-400 transition-all duration-300 rounded-xl hover:bg-purple-500/20 bg-black/40 border border-purple-400/30 backdrop-blur-sm font-medium"
            >
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
              </svg>
              è¿”å›ä¸»é¡µ
            </RouterLink>
          </div>
        </div>
      </div>

      <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
      <div class="page-header w-full max-w-6xl mx-auto px-6 !mt-8 !mb-12 text-center">
        <!-- ä¸»æ ‡é¢˜å®¹å™¨ - å¢å¼ºèƒŒæ™¯ -->
        <div class="relative bg-black/60 backdrop-blur-xl rounded-3xl border-2 border-purple-400/40 !p-6 shadow-2xl">
          <!-- è£…é¥°æ€§å…‰æ•ˆ -->
          <div class="absolute inset-0 rounded-3xl bg-gradient-to-r from-purple-500/10 via-pink-500/10 to-red-500/10 animate-pulse"></div>

          <div class="relative z-10">
            <!-- é¡¶éƒ¨è£…é¥°çº¿ -->
            <div class="flex items-center justify-center !mb-5">
              <div class="h-1 bg-gradient-to-r from-transparent via-purple-400 to-transparent w-32 rounded-full"></div>
              <div class="mx-4 w-4 h-4 bg-purple-400 rounded-full shadow-lg shadow-purple-400/50"></div>
              <div class="h-1 bg-gradient-to-r from-transparent via-purple-400 to-transparent w-32 rounded-full"></div>
            </div>

            <!-- ä¸»æ ‡é¢˜ -->
            <div class="!mb-5">
              <h1 class="text-3xl md:text-4xl lg:text-5xl font-black text-white !mb-3 tracking-tight leading-tight">
                <span class="bg-gradient-to-r from-purple-400 via-pink-400 to-red-400 bg-clip-text text-transparent drop-shadow-2xl">
                  é»„ç²±ä¸€æ¢¦å‘¨å¹´åº†é¢„çƒ­
                </span>
              </h1>
              <div class="text-shadow-glow text-purple-400 text-base font-medium !mb-2">ANNIVERSARY PRE-HEATING</div>
            </div>

            <!-- å‰¯æ ‡é¢˜ -->
            <h2 class="text-base md:text-lg lg:text-xl font-bold text-white/95 !mb-5 tracking-wide max-w-3xl mx-auto text-shadow-strong">
              çƒ­è¡€æ²¸è…¾ Â· è“„åŠ¿å¾…å‘ Â· ç²¾å½©é¢„å‘Š
            </h2>

            <!-- åº•éƒ¨è£…é¥°çº¿ -->
            <div class="flex items-center justify-center">
              <div class="h-1 bg-gradient-to-r from-transparent via-purple-400 to-transparent w-48 rounded-full"></div>
              <div class="mx-4 w-2 h-2 bg-purple-400 rounded-full shadow-lg shadow-purple-400/50"></div>
              <div class="h-1 bg-gradient-to-r from-transparent via-purple-400 to-transparent w-48 rounded-full"></div>
            </div>
          </div>
        </div>

        <!-- æè¿°æ–‡å­— -->
        <div class="max-w-4xl mx-auto !mt-5">
          <div class="backdrop-blur-xl bg-black/60 rounded-2xl !p-5 border-2 border-white/30 shadow-2xl">
            <p class="text-base md:text-lg text-white font-medium leading-relaxed text-shadow-strong">
              å‘¨å¹´åº†å³å°†æ¥ä¸´ï¼Œç²¾å½©æ´»åŠ¨è“„åŠ¿å¾…å‘ï¼
            </p>
          </div>
        </div>
      </div>

      <!-- å€’è®¡æ—¶åŒºåŸŸ -->
      <div class="countdown-section w-full max-w-7xl mx-auto px-6 !mb-14">
        <div class="text-center !mb-10">
          <div class="game-section-header">
            <h3 class="game-section-title">å‘¨å¹´åº†å€’è®¡æ—¶</h3>
            <div class="game-section-subtitle">COUNTDOWN TIMER</div>
            <p class="game-section-desc">è·ç¦»ç››å¤§å¼€å¯è¿˜æœ‰</p>
          </div>
        </div>

        <div class="countdown-display flex justify-center items-center space-x-4 !mb-8">
          <div class="game-countdown-item">
            <div class="countdown-value">{{ countdown.days }}</div>
            <div class="countdown-label">å¤©</div>
            <div class="countdown-label-en">DAYS</div>
          </div>
          <div class="countdown-separator">:</div>
          <div class="game-countdown-item">
            <div class="countdown-value">{{ countdown.hours }}</div>
            <div class="countdown-label">æ—¶</div>
            <div class="countdown-label-en">HOURS</div>
          </div>
          <div class="countdown-separator">:</div>
          <div class="game-countdown-item">
            <div class="countdown-value">{{ countdown.minutes }}</div>
            <div class="countdown-label">åˆ†</div>
            <div class="countdown-label-en">MINS</div>
          </div>
          <div class="countdown-separator">:</div>
          <div class="game-countdown-item">
            <div class="countdown-value">{{ countdown.seconds }}</div>
            <div class="countdown-label">ç§’</div>
            <div class="countdown-label-en">SECS</div>
          </div>
        </div>
      </div>

      <!-- é¢„çƒ­æ´»åŠ¨åŒºåŸŸ -->
      <div class="activities-section w-full max-w-6xl mx-auto px-6 !mb-14">
        <div class="text-center !mb-10">
          <div class="game-section-header">
            <h3 class="game-section-title">é¢„çƒ­æ´»åŠ¨</h3>
            <div class="game-section-subtitle">PRE-HEATING ACTIVITIES</div>
            <p class="game-section-desc">å‚ä¸é¢„çƒ­æ´»åŠ¨ï¼ŒæŠ¢å…ˆä½“éªŒç²¾å½©å†…å®¹</p>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- ç­¾åˆ°é¢†ç¤¼åŒ… -->
          <div class="game-activity-card group gift">
            <div class="activity-badge">ACTIVE</div>
            <div class="text-center !mb-6">
              <div class="activity-icon-container gift">
                <div class="activity-icon">ğŸ</div>
              </div>
              <h4 class="activity-title">ç­¾åˆ°é¢†ç¤¼åŒ…</h4>
              <div class="activity-subtitle">DAILY CHECK-IN</div>
              <p class="activity-description">å‚ä¸å‘¨å¹´åº†æ´»åŠ¨ï¼Œè·å¾—å‘¨å¹´åº†ä¸“å±ç¤¼åŒ…</p>
            </div>
            <div class="activity-progress">
              <div class="flex justify-between items-center !mb-3">
                <span class="progress-label">å‡†å¤‡è¿›åº¦</span>
                <span class="progress-percentage gift">100%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill gift-progress" :style="{ width: '100%' }"></div>
              </div>
              <div class="progress-status complete">æ´»åŠ¨å·²å°±ç»ª</div>
            </div>
          </div>

          <!-- é¢„çƒ­ä»»åŠ¡ -->
          <div class="game-activity-card group task">
            <div class="activity-badge task-badge">READY</div>
            <div class="text-center !mb-6">
              <div class="activity-icon-container task">
                <div class="activity-icon">âš¡</div>
              </div>
              <h4 class="activity-title">é¢„çƒ­ä»»åŠ¡</h4>
              <div class="activity-subtitle">PRE-HEATING MISSIONS</div>
              <p class="activity-description">å®Œæˆé¢„çƒ­ä»»åŠ¡ï¼Œè§£é”å‘¨å¹´åº†ç‹¬å®¶å†…å®¹</p>
            </div>
            <div class="activity-progress">
              <div class="flex justify-between items-center !mb-3">
                <span class="progress-label">è§£é”è¿›åº¦</span>
                <span class="progress-percentage task">100%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill task-progress" :style="{ width: '100%' }"></div>
              </div>
              <div class="progress-status complete">ä»»åŠ¡å·²å¼€æ”¾</div>
            </div>
          </div>
        </div>
      </div>

      <!-- å‘¨å¹´åº†å¥–åŠ±ç‰©å“å±•ç¤º -->
      <div class="rewards-section w-full max-w-7xl mx-auto px-6 !mb-14">
        <div class="text-center !mb-10">
          <div class="game-section-header">
            <h3 class="game-section-title">å‘¨å¹´åº†ä¸°åšå¥–åŠ±</h3>
            <div class="game-section-subtitle">ANNIVERSARY REWARDS</div>
            <p class="game-section-desc">ç²¾å¿ƒå‡†å¤‡çš„å‘¨å¹´åº†ä¸“å±å¥–åŠ±ï¼Œç­‰ä½ æ¥æ‹¿ï¼</p>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- CS2æ­¦å™¨çš®è‚¤ -->
          <div class="game-reward-card orange group">
            <div class="reward-badge legendary">LEGENDARY</div>
            <div class="reward-icon-wrapper orange">
              <span class="reward-icon">ğŸ”«</span>
            </div>
            <h4 class="reward-title">CS2æ­¦å™¨çš®è‚¤</h4>
            <div class="reward-subtitle">WEAPON SKINS</div>
            <p class="reward-description">ç²¾é€‰ç¨€æœ‰æ­¦å™¨çš®è‚¤ï¼Œå½°æ˜¾ç‹¬ç‰¹å“å‘³</p>
            <div class="reward-info">
              <div class="flex items-center justify-between !mb-2">
                <span class="reward-rarity-label">ç¨€æœ‰åº¦</span>
                <span class="reward-rarity orange-rarity">ä¼ è¯´çº§</span>
              </div>
              <div class="reward-details">åŒ…å«å¤šæ¬¾çƒ­é—¨æ­¦å™¨çš®è‚¤</div>
            </div>
          </div>

          <!-- å‘¨å¹´åº†ä¸“å±æ¨¡å‹çš®è‚¤ -->
          <div class="game-reward-card purple group">
            <div class="reward-badge limited">LIMITED</div>
            <div class="reward-icon-wrapper purple">
              <span class="reward-icon">ğŸ‘¤</span>
            </div>
            <h4 class="reward-title">ä¸“å±æ¨¡å‹çš®è‚¤</h4>
            <div class="reward-subtitle">PLAYER MODELS</div>
            <p class="reward-description">å‘¨å¹´åº†é™å®šè§’è‰²çš®è‚¤ï¼Œç‹¬ä¸€æ— äºŒ</p>
            <div class="reward-info">
              <div class="flex items-center justify-between !mb-2">
                <span class="reward-rarity-label">ç¨€æœ‰åº¦</span>
                <span class="reward-rarity purple-rarity">é™å®šç‰ˆ</span>
              </div>
              <div class="reward-details">å‘¨å¹´åº†ä¸“å±è®¾è®¡ï¼Œè¿‡æœŸä¸å€™</div>
            </div>
          </div>

          <!-- ç§¯åˆ†æŠ½å¥– -->
          <div class="game-reward-card yellow group">
            <div class="reward-badge bonus">BONUS</div>
            <div class="reward-icon-wrapper yellow">
              <span class="reward-icon">ğŸ°</span>
            </div>
            <h4 class="reward-title">ç§¯åˆ†æŠ½å¥–</h4>
            <div class="reward-subtitle">POINT LOTTERY</div>
            <p class="reward-description">æµ·é‡ç§¯åˆ†å¥–åŠ±ï¼Œç•…äº«æŠ½å¥–ä¹è¶£</p>
            <div class="reward-info">
              <div class="flex items-center justify-between !mb-2">
                <span class="reward-rarity-label">å¥–åŠ±èŒƒå›´</span>
                <span class="reward-rarity yellow-rarity">100-10000</span>
              </div>
              <div class="reward-details">æ¯æ—¥å…è´¹æŠ½å¥–æœºä¼š</div>
            </div>
          </div>

          <!-- ç²¾ç¾å£çº¸ -->
          <div class="game-reward-card cyan group">
            <div class="reward-badge premium">4K PREMIUM</div>
            <div class="reward-icon-wrapper cyan">
              <span class="reward-icon">ğŸ–¼ï¸</span>
            </div>
            <h4 class="reward-title">ç²¾ç¾å£çº¸</h4>
            <div class="reward-subtitle">WALLPAPERS</div>
            <p class="reward-description">é«˜æ¸…å‘¨å¹´åº†ä¸»é¢˜å£çº¸åˆé›†</p>
            <div class="reward-info">
              <div class="flex items-center justify-between !mb-2">
                <span class="reward-rarity-label">åˆ†è¾¨ç‡</span>
                <span class="reward-rarity cyan-rarity">4Kè¶…æ¸…</span>
              </div>
              <div class="reward-details">åŒ…å«å¤šæ¬¾ç²¾ç¾è®¾è®¡</div>
            </div>
          </div>

          <!-- ä¸“å±æ¢è‚¤æ¨¡å‹ -->
          <div class="game-reward-card green group">
            <div class="reward-badge interactive">INTERACTIVE</div>
            <div class="reward-icon-wrapper green">
              <span class="reward-icon">ğŸ¨</span>
            </div>
            <h4 class="reward-title">ä¸“å±æ¢è‚¤æ¨¡å‹</h4>
            <div class="reward-subtitle">CUSTOM MODELS</div>
            <p class="reward-description">å‘¨å¹´åº†ç‰¹åˆ¶æ¢è‚¤ç³»ç»Ÿ</p>
            <div class="reward-info">
              <div class="flex items-center justify-between !mb-2">
                <span class="reward-rarity-label">ç±»å‹</span>
                <span class="reward-rarity green-rarity">äº’åŠ¨å¼</span>
              </div>
              <div class="reward-details">æ”¯æŒè‡ªå®šä¹‰æ¢è‚¤</div>
            </div>
          </div>

          <!-- ç¥ç§˜å¤§å¥– -->
          <div class="game-reward-card indigo group mystery">
            <div class="reward-badge mystery-badge animate-pulse">MYSTERY</div>
            <div class="reward-icon-wrapper indigo">
              <span class="reward-icon animate-pulse">ğŸ</span>
            </div>
            <h4 class="reward-title">ç¥ç§˜å¤§å¥–</h4>
            <div class="reward-subtitle">MYSTERY PRIZE</div>
            <p class="reward-description">å‘¨å¹´åº†ç»ˆæå¥–åŠ±ï¼Œæ•¬è¯·æœŸå¾…</p>
            <div class="reward-info">
              <div class="flex items-center justify-between !mb-2">
                <span class="reward-rarity-label">ç¨€æœ‰åº¦</span>
                <span class="reward-rarity indigo-rarity">???</span>
              </div>
              <div class="reward-details">å‘¨å¹´åº†å½“æ—¥æ­æ™“</div>
            </div>
          </div>
        </div>

        <!-- å¥–åŠ±è¯´æ˜ -->
        <div class="reward-notice !mt-10">
          <div class="game-footer-container">
            <p class="text-lg text-white font-bold !mb-3 text-shadow-strong">
              <span class="inline-flex items-center">
                <span class="!mr-2">ğŸ‰</span>
                æ‰€æœ‰å¥–åŠ±å‡ä¸ºå‘¨å¹´åº†ä¸“å±ï¼Œå‚ä¸æ´»åŠ¨å³æœ‰æœºä¼šè·å¾—
                <span class="!ml-2">ğŸ‰</span>
              </span>
            </p>
            <p class="text-white/90 text-base">
              æ›´å¤šæƒŠå–œå¥–åŠ±å°†åœ¨å‘¨å¹´åº†æ­£å¼å¼€å¯æ—¶å…¬å¸ƒï¼Œæ•¬è¯·æœŸå¾…ï¼
            </p>
          </div>
        </div>
      </div>

      <!-- å¿«æ·æŒ‰é’® -->
      <div class="actions-section w-full max-w-4xl mx-auto px-6 !mb-12">
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
          <RouterLink
            v-if="isAnniversaryStarted"
            to="/anniversary"
            class="game-btn-primary group"
          >
            <span class="!mr-3 text-xl group-hover:scale-110 transition-transform duration-300">ğŸ‰</span>
            ç«‹å³å‚ä¸
          </RouterLink>
          <button
            v-else
            disabled
            class="game-btn-disabled"
          >
            <span class="!mr-3 text-xl">â³</span>
            æ•¬è¯·æœŸå¾…
          </button>
          <button
            @click="sharePreheating"
            class="game-btn-secondary group"
          >
            <span class="!mr-3 text-xl group-hover:scale-110 transition-transform duration-300">ğŸ“¢</span>
            åˆ†äº«é¢„çƒ­
          </button>
        </div>
      </div>

      <!-- åº•éƒ¨ä¿¡æ¯æ  -->
      <div class="footer-info w-full max-w-6xl mx-auto px-6">
        <div class="game-footer-container">
          <p class="text-lg text-white font-bold !mb-3 text-shadow-strong">
            <span class="inline-flex items-center">
              <span class="!mr-2">ğŸ”¥</span>
              é¢„çƒ­é˜¶æ®µç²¾å½©çº·å‘ˆï¼Œæ­£å¼åº†å…¸æ›´åŠ éœ‡æ’¼
              <span class="!ml-2">ğŸ”¥</span>
            </span>
          </p>
          <p class="text-white/90 text-base">
            é‚€è¯·å¥½å‹ä¸€èµ·é¢„çƒ­ï¼Œå…±åŒè§è¯å†å²æ—¶åˆ»ï¼
          </p>
        </div>
      </div>
    </div>

    <!-- åˆ†äº«å¼¹çª— -->
    <div
      v-if="showShareModal"
      class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50"
      @click="closeShareModal"
    >
      <div
        class="game-modal-content"
        @click.stop
      >
        <div class="text-center !mb-8">
          <h3 class="text-2xl font-black text-gray-800 !mb-3 text-shadow">åˆ†äº«é¢„çƒ­æ´»åŠ¨</h3>
          <p class="text-gray-600 text-base">é‚€è¯·å¥½å‹ä¸€èµ·å‚ä¸å‘¨å¹´åº†é¢„çƒ­ï¼</p>
        </div>

        <div class="!mb-8">
          <label class="block text-base font-black text-gray-700 !mb-3">åˆ†äº«é“¾æ¥</label>
          <div class="flex items-center space-x-3">
            <input
              v-model="shareUrl"
              readonly
              class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg bg-gray-50 text-sm font-mono shadow-inner"
            >
            <button
              @click="copyToClipboard"
              class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-black text-base shadow-lg"
            >
              å¤åˆ¶
            </button>
          </div>
        </div>

        <div class="flex space-x-4">
          <button
            @click="shareToQQ"
            class="flex-1 flex items-center justify-center px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all duration-300 shadow-xl font-black text-base"
          >
            <span class="!mr-2 text-lg">ğŸ§</span>
            åˆ†äº«åˆ°QQ
          </button>
          <button
            @click="closeShareModal"
            class="px-8 py-4 bg-gray-400 text-gray-700 rounded-xl hover:bg-gray-500 transition-colors font-black text-base shadow-lg"
          >
            å–æ¶ˆ
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted, computed } from 'vue'
import { RouterLink } from 'vue-router'

// å‘¨å¹´åº†å¼€å§‹æ—¶é—´ - 8æœˆ1æ—¥ 2025å¹´
const ANNIVERSARY_START_DATE = new Date('2025-08-01 00:00:00')

// å“åº”å¼æ•°æ®
const signInDays = ref(0)
const taskProgress = ref(0)
const showShareModal = ref(false)
const shareUrl = ref('')

// å€’è®¡æ—¶æ•°æ®
const countdown = ref({
  days: 0,
  hours: 0,
  minutes: 0,
  seconds: 0
})

let countdownTimer: number | null = null

// è®¡ç®—æ˜¯å¦å·²ç»å¼€å§‹å‘¨å¹´åº†
const isAnniversaryStarted = computed(() => {
  return new Date() >= ANNIVERSARY_START_DATE
})

// åˆ†äº«é¢„çƒ­æ´»åŠ¨
const sharePreheating = () => {
  shareUrl.value = window.location.href
  showShareModal.value = true
}

// å…³é—­åˆ†äº«å¼¹çª—
const closeShareModal = () => {
  showShareModal.value = false
}

// å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
const copyToClipboard = async () => {
  try {
    await navigator.clipboard.writeText(shareUrl.value)
    alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼')
  } catch (err) {
    console.error('å¤åˆ¶å¤±è´¥:', err)
    // å…œåº•æ–¹æ¡ˆ
    const textArea = document.createElement('textarea')
    textArea.value = shareUrl.value
    document.body.appendChild(textArea)
    textArea.select()
    document.execCommand('copy')
    document.body.removeChild(textArea)
    alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼')
  }
}

// åˆ†äº«åˆ°QQ
const shareToQQ = () => {
  const title = 'å‘¨å¹´åº†é¢„çƒ­æ´»åŠ¨'
  const description = 'çƒ­è¡€æ²¸è…¾Â·è“„åŠ¿å¾…å‘Â·ç²¾å½©é¢„å‘Šï¼Œå¿«æ¥å‚ä¸å‘¨å¹´åº†é¢„çƒ­æ´»åŠ¨ï¼'
  const qqShareUrl = `https://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(shareUrl.value)}&title=${encodeURIComponent(title)}&desc=${encodeURIComponent(description)}`
  window.open(qqShareUrl, '_blank')
}

// æ›´æ–°å€’è®¡æ—¶
const updateCountdown = () => {
  const now = new Date()
  const timeDiff = ANNIVERSARY_START_DATE.getTime() - now.getTime()

  if (timeDiff > 0) {
    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24))
    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))
    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60))
    const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000)

    countdown.value = { days, hours, minutes, seconds }
  } else {
    countdown.value = { days: 0, hours: 0, minutes: 0, seconds: 0 }
  }
}

// è®¡ç®—è¿›åº¦
const calculateProgress = () => {
  const now = new Date()
  const preheatingStartDate = new Date('2025-07-01 00:00:00') // é¢„çƒ­å¼€å§‹æ—¶é—´
  const totalDuration = ANNIVERSARY_START_DATE.getTime() - preheatingStartDate.getTime()
  const elapsedTime = now.getTime() - preheatingStartDate.getTime()

  if (elapsedTime < 0) {
    // é¢„çƒ­è¿˜æœªå¼€å§‹
    signInDays.value = 0
    taskProgress.value = 0
  } else if (elapsedTime >= totalDuration) {
    // å‘¨å¹´åº†å·²ç»å¼€å§‹
    signInDays.value = 7
    taskProgress.value = 100
  } else {
    // é¢„çƒ­è¿›è¡Œä¸­
    const progressRatio = elapsedTime / totalDuration
    signInDays.value = Math.floor(progressRatio * 7)
    taskProgress.value = Math.floor(progressRatio * 100)
  }
}

// ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–æ•°æ®
onMounted(() => {
  calculateProgress()
  updateCountdown()

  // å¯åŠ¨å€’è®¡æ—¶
  countdownTimer = window.setInterval(() => {
    updateCountdown()
    calculateProgress()
  }, 1000)
})

// ç»„ä»¶å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
onUnmounted(() => {
  if (countdownTimer) {
    clearInterval(countdownTimer)
  }
})
</script>

<style scoped>
/* æ¸¸æˆé£æ ¼æŒ‰é’®æ ·å¼ - é¢„çƒ­ç´«è‰²ä¸»é¢˜ */
.game-btn-primary {
  @apply inline-flex items-center px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-black rounded-xl shadow-2xl hover:shadow-purple-500/30 transition-all duration-300 transform hover:scale-105 backdrop-blur-lg border-2 border-purple-400/50 text-lg;
}

.game-btn-secondary {
  @apply inline-flex items-center px-8 py-4 backdrop-blur-xl bg-black/60 hover:bg-black/80 border-2 border-white/50 hover:border-purple-400/70 text-white font-black rounded-xl shadow-2xl hover:shadow-white/20 transition-all duration-300 transform hover:scale-105 text-lg;
}

.game-btn-disabled {
  @apply inline-flex items-center px-8 py-4 bg-gray-600/60 border-2 border-gray-400/30 text-white/60 font-black rounded-xl shadow-xl cursor-not-allowed backdrop-blur-lg text-lg;
}

/* æ¸¸æˆé£æ ¼å€’è®¡æ—¶ */
.game-countdown-item {
  @apply backdrop-blur-xl bg-black/70 rounded-2xl text-center shadow-2xl border-2 border-purple-400/40 hover:bg-black/80 transition-all duration-300 hover:scale-105;
  padding: 1.5rem !important;
  min-width: 110px !important;
}

.countdown-value {
  @apply text-3xl md:text-4xl font-black text-purple-400 text-shadow-strong;
  margin-bottom: 0.5rem !important;
}

.countdown-label {
  @apply text-white font-bold text-base text-shadow;
  margin-bottom: 0.25rem !important;
}

.countdown-label-en {
  @apply text-purple-400/80 text-xs font-medium tracking-wider uppercase;
}

.countdown-separator {
  @apply text-2xl font-black text-white text-shadow-strong;
}

/* æ¸¸æˆé£æ ¼æ´»åŠ¨å¡ç‰‡ */
.game-activity-card {
  @apply p-6 rounded-2xl backdrop-blur-xl bg-black/70 border-2 shadow-2xl transition-all duration-500 transform hover:scale-105 hover:bg-black/80 text-center relative overflow-hidden;
}

.game-activity-card.gift {
  @apply border-yellow-400/60 hover:border-yellow-400/80 hover:shadow-yellow-500/30;
}

.game-activity-card.task {
  @apply border-blue-400/60 hover:border-blue-400/80 hover:shadow-blue-500/30;
}

.activity-badge {
  @apply absolute -top-2 -right-2 px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 text-white text-xs font-black rounded-full shadow-lg;
}

.task-badge {
  @apply bg-gradient-to-r from-blue-500 to-blue-600;
}

.activity-icon-container {
  @apply w-16 h-16 mx-auto rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300;
  margin-bottom: 1rem !important;
}

.activity-icon-container.gift {
  @apply bg-gradient-to-br from-yellow-400 to-orange-400;
}

.activity-icon-container.task {
  @apply bg-gradient-to-br from-blue-400 to-indigo-400;
}

.activity-icon {
  @apply text-2xl drop-shadow-lg;
}

.activity-title {
  @apply text-xl font-black text-white text-shadow-strong;
  margin-bottom: 0.5rem !important;
}

.activity-subtitle {
  @apply text-purple-400/80 text-xs font-bold tracking-widest uppercase;
  margin-bottom: 1rem !important;
}

.activity-description {
  @apply text-white/90 leading-relaxed text-base font-medium text-shadow;
}

.activity-progress {
  @apply bg-black/40 rounded-xl border-2 border-white/20 shadow-inner;
  padding: 1rem !important;
}

.progress-label {
  @apply text-sm text-white font-bold;
}

.progress-percentage {
  @apply text-sm font-black;
}

.progress-percentage.gift {
  @apply text-yellow-400;
}

.progress-percentage.task {
  @apply text-blue-400;
}

.progress-bar {
  @apply w-full bg-gray-600 rounded-full shadow-inner;
  height: 8px !important;
}

.progress-fill {
  @apply rounded-full transition-all duration-500;
  height: 8px !important;
}

.gift-progress {
  @apply bg-gradient-to-r from-yellow-400 to-orange-400 shadow-lg;
}

.task-progress {
  @apply bg-gradient-to-r from-blue-400 to-indigo-400 shadow-lg;
}

.progress-status {
  @apply text-center font-bold text-sm;
  margin-top: 0.75rem !important;
}

.progress-status.complete {
  @apply text-green-400;
}

/* æ¸¸æˆé£æ ¼å¥–åŠ±å¡ç‰‡ */
.game-reward-card {
  @apply p-6 rounded-2xl backdrop-blur-xl border-2 shadow-2xl transition-all duration-500 transform hover:scale-105 relative overflow-hidden text-center;
}

.game-reward-card.orange {
  @apply bg-gradient-to-br from-orange-500/20 to-red-500/20 border-orange-400/80 hover:from-orange-500/30 hover:to-red-500/30 hover:shadow-orange-500/30;
}

.game-reward-card.purple {
  @apply bg-gradient-to-br from-purple-500/20 to-pink-500/20 border-purple-400/80 hover:from-purple-500/30 hover:to-pink-500/30 hover:shadow-purple-500/30;
}

.game-reward-card.yellow {
  @apply bg-gradient-to-br from-yellow-500/20 to-orange-500/20 border-yellow-400/80 hover:from-yellow-500/30 hover:to-orange-500/30 hover:shadow-yellow-500/30;
}

.game-reward-card.cyan {
  @apply bg-gradient-to-br from-cyan-500/20 to-blue-500/20 border-cyan-400/80 hover:from-cyan-500/30 hover:to-blue-500/30 hover:shadow-cyan-500/30;
}

.game-reward-card.green {
  @apply bg-gradient-to-br from-green-500/20 to-emerald-500/20 border-green-400/80 hover:from-green-500/30 hover:to-emerald-500/30 hover:shadow-green-500/30;
}

.game-reward-card.indigo {
  @apply bg-gradient-to-br from-indigo-500/20 to-purple-500/20 border-indigo-400/80 hover:from-indigo-500/30 hover:to-purple-500/30 hover:shadow-indigo-500/30;
}

.reward-badge {
  @apply absolute -top-2 -left-2 px-2 py-1 text-white text-xs font-black rounded-full shadow-lg transform -rotate-12;
}

.reward-badge.legendary {
  @apply bg-gradient-to-r from-orange-500 to-red-500;
}

.reward-badge.limited {
  @apply bg-gradient-to-r from-purple-500 to-pink-500;
}

.reward-badge.bonus {
  @apply bg-gradient-to-r from-yellow-500 to-orange-500;
}

.reward-badge.premium {
  @apply bg-gradient-to-r from-cyan-500 to-blue-500;
}

.reward-badge.interactive {
  @apply bg-gradient-to-r from-green-500 to-emerald-500;
}

.mystery-badge {
  @apply bg-gradient-to-r from-indigo-500 to-purple-500;
}

.reward-icon-wrapper {
  @apply w-16 h-16 mx-auto rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300;
  margin-bottom: 1rem !important;
}

.reward-icon-wrapper.orange {
  @apply bg-gradient-to-br from-orange-400 to-red-400;
}

.reward-icon-wrapper.purple {
  @apply bg-gradient-to-br from-purple-400 to-pink-400;
}

.reward-icon-wrapper.yellow {
  @apply bg-gradient-to-br from-yellow-400 to-orange-400;
}

.reward-icon-wrapper.cyan {
  @apply bg-gradient-to-br from-cyan-400 to-blue-400;
}

.reward-icon-wrapper.green {
  @apply bg-gradient-to-br from-green-400 to-emerald-400;
}

.reward-icon-wrapper.indigo {
  @apply bg-gradient-to-br from-indigo-400 to-purple-400;
}

.reward-icon {
  @apply text-2xl drop-shadow-lg;
}

.reward-title {
  @apply text-lg font-black text-white text-shadow-strong;
  margin-bottom: 0.5rem !important;
}

.reward-subtitle {
  @apply text-purple-400/80 text-xs font-bold tracking-widest uppercase;
  margin-bottom: 1rem !important;
}

.reward-description {
  @apply text-white/90 text-sm leading-relaxed font-medium text-shadow;
  margin-bottom: 1.5rem !important;
}

.reward-info {
  @apply bg-black/30 rounded-lg border-2 border-white/20 shadow-inner;
  padding: 1rem !important;
}

.reward-rarity-label {
  @apply text-xs font-bold text-white/90;
}

.reward-rarity {
  @apply text-xs font-black px-3 py-1 rounded-full;
}

.orange-rarity {
  @apply text-orange-200 bg-orange-400/30 border border-orange-400/50;
}

.purple-rarity {
  @apply text-purple-200 bg-purple-400/30 border border-purple-400/50;
}

.yellow-rarity {
  @apply text-yellow-200 bg-yellow-400/30 border border-yellow-400/50;
}

.cyan-rarity {
  @apply text-cyan-200 bg-cyan-400/30 border border-cyan-400/50;
}

.green-rarity {
  @apply text-green-200 bg-green-400/30 border border-green-400/50;
}

.indigo-rarity {
  @apply text-indigo-200 bg-indigo-400/30 border border-indigo-400/50;
}

.reward-details {
  @apply text-xs text-white/80 font-medium;
  margin-top: 0.75rem !important;
}

/* æ¸¸æˆé£æ ¼åŒºåŸŸæ ‡é¢˜ */
.game-section-header {
  @apply backdrop-blur-xl bg-black/60 rounded-2xl border-2 border-white/30 shadow-2xl;
  padding: 1.5rem !important;
}

.game-section-title {
  @apply text-2xl md:text-3xl font-black text-white text-shadow-strong;
  margin-bottom: 0.5rem !important;
}

.game-section-subtitle {
  @apply text-purple-400 font-bold text-sm tracking-widest;
  margin-bottom: 0.75rem !important;
}

.game-section-desc {
  @apply text-base md:text-lg text-white/90 max-w-3xl mx-auto font-medium text-shadow;
}

/* æ¸¸æˆé£æ ¼åˆ†äº«å¼¹çª— */
.game-modal-content {
  @apply bg-white rounded-2xl max-w-lg w-full mx-4 shadow-2xl backdrop-blur-xl border-2 border-gray-200;
  padding: 2rem !important;
}

.game-footer-container {
  @apply text-center rounded-2xl backdrop-blur-xl bg-black/60 border-2 border-white/30 shadow-2xl;
  padding: 1.5rem !important;
}

/* å“åº”å¼ä¼˜åŒ– */
@media (max-width: 768px) {
  .game-countdown-item {
    padding: 1rem !important;
    min-width: 80px !important;
  }

  .countdown-value {
    @apply text-xl;
  }

  .game-activity-card {
    padding: 1.5rem !important;
  }

  .game-reward-card {
    padding: 1.5rem !important;
  }

  .reward-icon-wrapper, .activity-icon-container {
    @apply w-14 h-14;
    margin-bottom: 0.75rem !important;
  }

  .reward-icon, .activity-icon {
    @apply text-lg;
  }

  .reward-title, .activity-title {
    @apply text-base;
  }

  .game-modal-content {
    padding: 1.5rem !important;
  }

  .game-section-header {
    padding: 1rem !important;
  }
}

/* æ–‡å­—é˜´å½±æ•ˆæœ */
.text-shadow {
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
}

.text-shadow-strong {
  text-shadow: 0 4px 12px rgba(0, 0, 0, 0.8), 0 2px 4px rgba(0, 0, 0, 0.6);
}

.text-shadow-glow {
  text-shadow: 0 0 20px currentColor, 0 4px 12px rgba(0, 0, 0, 0.8);
}

/* é¡µé¢ç‰¹å®šæ ·å¼ */
.preheating-page {
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}
</style>
